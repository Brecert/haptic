const p=[];let o,r;function T(t){const e=(...n)=>{if(!n.length)return o&&!e._computeds.has(o)&&(e._computeds.add(o),o._depSockets.push(e)),t;const[s]=n;if(r)return e._pending===p&&r.push(e),e._pending=s,s;t=s;const d=o;return o=void 0,e._computedsRan=new Set(e._computeds),e._computedsRan.forEach(c=>{c._stale=!0}),e._computedsRan.forEach(c=>{c._stale&&c()}),o=d,t};return e.$o=1,e._computeds=new Set,e._computedsRan=void 0,e._pending=p,e}function l(t){let e;const n=()=>{const d=o;o&&o._children.push(n);const c=n._children;i(n),n._stale=!1,o=n,e=t(),c.forEach(u=>{n._children.indexOf(u)===-1&&(u._stale=!1)});const m=u=>u.reduce((a,_)=>a.concat(_,m(_._children)),[]),k=m(n._children);return k.forEach(u=>{u._stale||u._depSockets.forEach(a=>{a._computedsRan&&a._computedsRan.delete(u)})}),o=d,e};n._stale=!0,n._depSockets=[],n._children=[];const s=()=>(n._stale?e=n():n._depSockets.forEach(d=>{d()}),e);return s.$o=1,s._computed=n,t._computed=n,f(n),n(),s}function S(t){return l(t),()=>h(t)}function h(t){return i(t._computed)}function i(t){t._children.forEach(i),t._depSockets.forEach(e=>{e._computeds.delete(t),e._computedsRan&&e._computedsRan.delete(t)}),f(t)}function f(t){t._depSockets=[],t._children=[]}function y(t){const e=r;r=[];const n=t(),s=r;return r=e,s.forEach(d=>{if(d._pending!==p){const c=d._pending;d._pending=p,d(c)}}),n}function C(t){const e=o;o=void 0;const n=t();return o=e,n}function g(t,e,n={onlyChanges:!0}){return t=[].concat(t),l(()=>{t.forEach(d=>{d()});let s;return n.onlyChanges||(s=C(e)),n.onlyChanges=!1,s})}export{l as computed,g as on,T as s,C as sample,T as socket,S as subscribe,y as transaction,h as unsubscribe};
//# sourceMappingURL=index.js.map
